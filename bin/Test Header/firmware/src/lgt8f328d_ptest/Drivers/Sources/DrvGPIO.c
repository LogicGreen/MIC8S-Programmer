/**********************************************
 * GPIO Driver
 **********************************************/

#include "allinone.h"

#define ARG_DDRB (GPIO_DDB7 << 7)|(GPIO_DDB6 << 6)|(GPIO_DDB5 << 5)|(GPIO_DDB4 << 4)| \
		(GPIO_DDB3 << 3)|(GPIO_DDB2 << 2)|(GPIO_DDB1 << 1)|GPIO_DDB0
#define ARG_DDRC (GPIO_DDC6 << 6)|(GPIO_DDC5 << 5)|(GPIO_DDC4 << 4)| \
		(GPIO_DDC3 << 3)|(GPIO_DDC2 << 2)|(GPIO_DDC1 << 1)|GPIO_DDC0
#define ARG_DDRD (GPIO_DDD7 << 7)|(GPIO_DDD6 << 6)|(GPIO_DDD5 << 5)|(GPIO_DDD4 << 4)| \
		(GPIO_DDD3 << 3)|(GPIO_DDD2 << 2)|(GPIO_DDD1 << 1)|GPIO_DDD0
#define ARG_DDRE (GPIO_DDE6 << 6)|(GPIO_DDE5 << 5)|(GPIO_DDE4 << 4)| \
		(GPIO_DDE3 << 3)|(GPIO_DDE2 << 2)|(GPIO_DDE1 << 1)|GPIO_DDE0

#define ARG_PORTB (GPIO_PDB7 << 7)|(GPIO_PDB6 << 6)|(GPIO_PDB5 << 5)|(GPIO_PDB4 << 4)| \
		(GPIO_PDB3 << 3)|(GPIO_PDB2 << 2)|(GPIO_PDB1 << 1)|GPIO_PDB0
#define ARG_PORTC (GPIO_PDC6 << 6)|(GPIO_PDC5 << 5)|(GPIO_PDC4 << 4)| \
		(GPIO_PDC3 << 3)|(GPIO_PDC2 << 2)|(GPIO_PDC1 << 1)|GPIO_PDC0
#define ARG_PORTD (GPIO_PDD7 << 7)|(GPIO_PDD6 << 6)|(GPIO_PDD5 << 5)|(GPIO_PDD4 << 4)| \
		(GPIO_PDD3 << 3)|(GPIO_PDD2 << 2)|(GPIO_PDD1 << 1)|GPIO_PDD0
#define ARG_PORTE (GPIO_PDE6 << 6)|(GPIO_PDE5 << 5)|(GPIO_PDE4 << 4)| \
		(GPIO_PDE3 << 3)|(GPIO_PDE2 << 2)|(GPIO_PDE1 << 1)|GPIO_PDE0

#define ARG_PCIBEN GPIO_PCIB7MSK|GPIO_PCIB6MSK|GPIO_PCIB5MSK|GPIO_PCIB4MSK|GPIO_PCIB3MSK|GPIO_PCIB2MSK|GPIO_PCIB1MSK|GPIO_PCIB0MSK
#define ARG_PCICEN GPIO_PCIC6MSK|GPIO_PCIC5MSK|GPIO_PCIC4MSK|GPIO_PCIC3MSK|GPIO_PCIC2MSK|GPIO_PCIC1MSK|GPIO_PCIC0MSK
#define ARG_PCIDEN GPIO_PCID7MSK|GPIO_PCID6MSK|GPIO_PCID5MSK|GPIO_PCID4MSK|GPIO_PCID3MSK|GPIO_PCID2MSK|GPIO_PCID1MSK|GPIO_PCID0MSK
#define ARG_PCIEEN GPIO_PCIE6MSK|GPIO_PCIE5MSK|GPIO_PCIE4MSK|GPIO_PCIE3MSK|GPIO_PCIE2MSK|GPIO_PCIE1MSK|GPIO_PCIE0MSK

#define ARG_PCIBMSK (GPIO_PCIB7MSK << 7)|(GPIO_PCIB6MSK << 6)|(GPIO_PCIB5MSK << 5)|(GPIO_PCIB4MSK << 4)| \
		(GPIO_PCIB3MSK << 3)|(GPIO_PCIB2MSK << 2)|(GPIO_PCIB1MSK << 1)|GPIO_PCIB0MSK
#define ARG_PCICMSK (GPIO_PCIC6MSK << 6)|(GPIO_PCIC5MSK << 5)|(GPIO_PCIC4MSK << 4)| \
		(GPIO_PCIC3MSK << 3)|(GPIO_PCIC2MSK << 2)|(GPIO_PCIC1MSK << 1)|GPIO_PCIC0MSK
#define ARG_PCIDMSK (GPIO_PCID7MSK << 7)|(GPIO_PCID6MSK << 6)|(GPIO_PCID5MSK << 5)|(GPIO_PCID4MSK << 4)| \
		(GPIO_PCID3MSK << 3)|(GPIO_PCID2MSK << 2)|(GPIO_PCID1MSK << 1)|GPIO_PCID0MSK
#define ARG_PCIEMSK (GPIO_PCIE6MSK << 6)|(GPIO_PCIE5MSK << 5)|(GPIO_PCIE4MSK << 4)| \
		(GPIO_PCIE3MSK << 3)|(GPIO_PCIE2MSK << 2)|(GPIO_PCIE1MSK << 1)|GPIO_PCIE0MSK

void DrvGPIO_Init(void)
{
	u8 u8Tmp;

	DDRB |= ARG_DDRB;
	PORTB |= ARG_PORTB;

	DDRC |= ARG_DDRC;
	PORTC |= ARG_PORTC;

	DDRD |= ARG_DDRD;
	PORTD |= ARG_PORTD;

	DDRE |= ARG_DDRE;
	PORTE |= ARG_PORTE;

#if (GPIO_EXINT0EN | GPIO_EXINT1EN)
	/** Store SREG, & disable globall interupt */
	u8Tmp = SREG;
	CLI();
	/** Set Interrupt Sense */
	EICRA = (GPIO_EXINT0ISC << ISC00) | (GPIO_EXINT1ISC << ISC10);
	/** Set Interrupt Enable */
	EIMSK = (GPIO_EXINT0EN << INT0) | (GPIO_EXINT1EN << INT1);
	/** Clear interupt flag */
	EIFR = (GPIO_EXINT0EN << INT0) | (GPIO_EXINT1EN << INT1);
	/** Restore SREG */
	SREG = u8Tmp;
#endif

#if (ARG_PCIBEN | ARG_PCICEN | ARG_PCIDEN | ARG_PCIEEN)
	/** Store SREG & disable global interrupt */
	u8Tmp = SREG;
	CLI();
	/** Set PIN Change Interrupt Mask */
#if ARG_PCIBEN
	PCMSK0 = ARG_PCIBMSK;
#endif
#if ARG_PCICEN
	PCMSK1 = ARG_PCICMSK;
#endif
#if ARG_PCIDEN
	PCMSK2 = ARG_PCIDMSK;
#endif
#if ARG_PCIEEN
	PCMSK3 = ARG_PCIEMSK;
#endif
	/** Set PIN Change Interrupt Enable */
	PCICR = (ARG_PCIBEN << PCIE0) | (ARG_PCICEN << PCIE1) | \
			(ARG_PCIDEN << PCIE2) | (ARG_PCIEEN << PCIE3);
	/** Clear Interrupt Flag */
	PCIFR = (ARG_PCIBEN << PCIE0) | (ARG_PCICEN << PCIE1) | \
			(ARG_PCIDEN << PCIE2) | (ARG_PCIEEN << PCIE3);
	/** Restore SREG */
	SREG = u8Tmp;
#endif

}
